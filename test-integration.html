<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ - Wedding API</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #f8f6f0, #ede7d9);
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 25px 0;
            padding: 20px;
            border-radius: 10px;
            background: #f9f7f4;
        }
        .success { border-left: 5px solid #28a745; }
        .error { border-left: 5px solid #dc3545; }
        .info { border-left: 5px solid #17a2b8; }
        button {
            background: linear-gradient(135deg, #8B4513, #654321);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px 5px;
            font-weight: bold;
        }
        button:hover { transform: translateY(-2px); }
        .result {
            margin: 15px 0;
            padding: 15px;
            border-radius: 8px;
            background: #fff;
            border: 1px solid #ddd;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Wedding API</h1>
        <p><strong>GitHub Pages:</strong> https://webdev-it.github.io/felixme/wedding/</p>
        - **Backend API**: [https://wedding-invitation-backend-lj0d.onrender.com](https://wedding-invitation-backend-lj0d.onrender.com)

        <div class="test-section info">
            <h3>1Ô∏è‚É£ Health Check API</h3>
            <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å backend —Å–µ—Ä–≤–µ—Ä–∞</p>
            <button onclick="testHealthCheck()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Health Check</button>
            <div id="health-result" class="result" style="display: none;"></div>
        </div>

        <div class="test-section info">
            <h3>2Ô∏è‚É£ CORS —Ç–µ—Å—Ç</h3>
            <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ API –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã —Å –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞</p>
            <button onclick="testCORS()">–¢–µ—Å—Ç CORS</button>
            <div id="cors-result" class="result" style="display: none;"></div>
        </div>

        <div class="test-section info">
            <h3>3Ô∏è‚É£ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–π —Ñ–æ—Ä–º—ã</h3>
            <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ª–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é API</p>
            <input type="text" id="testName" placeholder="–í–∞—à–µ –∏–º—è –¥–ª—è —Ç–µ—Å—Ç–∞" value="–¢–µ—Å—Ç–æ–≤—ã–π –≥–æ—Å—Ç—å">
            <select id="testAttendance">
                <option value="–ë—É–¥—É –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å">–ë—É–¥—É –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å</option>
                <option value="–ù–µ —Å–º–æ–≥—É –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å">–ù–µ —Å–º–æ–≥—É –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å</option>
            </select>
            <br><br>
            <button onclick="testFormSubmission()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é —Ñ–æ—Ä–º—É</button>
            <div id="form-result" class="result" style="display: none;"></div>
        </div>

        <div class="test-section info">
            <h3>4Ô∏è‚É£ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é</h3>
            <ol>
                <li><strong>Backend:</strong> –°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ GitHub –∏ —Ä–∞–∑–≤–µ—Ä–Ω–∏—Ç–µ –Ω–∞ Render.com</li>
                <li><strong>Frontend:</strong> –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª—ã –∏–∑ –ø–∞–ø–∫–∏ frontend/ –≤ /felixme/wedding/</li>
                <li><strong>Gmail:</strong> –°–æ–∑–¥–∞–π—Ç–µ App Password –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ Environment Variables</li>
                <li><strong>–¢–µ—Å—Ç:</strong> –û—Ç–∫—Ä–æ–π—Ç–µ https://webdev-it.github.io/felixme/wedding/ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ñ–æ—Ä–º—É</li>
            </ol>
        </div>
    </div>

    <script>
        const API_URL = window.location.hostname === 'localhost' 
            ? 'http://localhost:3000' 
            : 'https://wedding-invitation-backend-lj0d.onrender.com';

        async function testHealthCheck() {
            const resultDiv = document.getElementById('health-result');
            resultDiv.style.display = 'block';
            resultDiv.textContent = '‚è≥ –ü—Ä–æ–≤–µ—Ä—è–µ–º health check...';
            
            try {
                const response = await fetch(`${API_URL}/api/health`);
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `‚úÖ SUCCESS!\n\n–û—Ç–≤–µ—Ç: ${JSON.stringify(data, null, 2)}`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `‚ùå ERROR: ${response.status}\n\n${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå FETCH ERROR:\n\n${error.message}\n\n–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:\n- Backend –Ω–µ –∑–∞–ø—É—â–µ–Ω\n- CORS –ø—Ä–æ–±–ª–µ–º–∞\n- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL`;
            }
        }

        async function testCORS() {
            const resultDiv = document.getElementById('cors-result');
            resultDiv.style.display = 'block';
            resultDiv.textContent = '‚è≥ –¢–µ—Å—Ç–∏—Ä—É–µ–º CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏...';
            
            try {
                const response = await fetch(`${API_URL}/`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `‚úÖ CORS —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!\n\n–û—Ç–∫—Ä—ã—Ç—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏:\n${Array.from(response.headers.entries()).map(([k,v]) => `${k}: ${v}`).join('\n')}`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `‚ùå CORS ERROR: ${response.status}`;
                }
            } catch (error) {
                if (error.message.includes('CORS')) {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `‚ùå CORS –ë–õ–û–ö–ò–†–û–í–ö–ê!\n\n–û—à–∏–±–∫–∞: ${error.message}\n\n–†–µ—à–µ–Ω–∏–µ:\n1. –î–æ–±–∞–≤—å—Ç–µ –≤–∞—à –¥–æ–º–µ–Ω –≤ CORS origins –Ω–∞ backend\n2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ backend –∑–∞–ø—É—â–µ–Ω`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `‚ùå NETWORK ERROR: ${error.message}`;
                }
            }
        }

        async function testFormSubmission() {
            const resultDiv = document.getElementById('form-result');
            const name = document.getElementById('testName').value;
            const attendance = document.getElementById('testAttendance').value;
            
            if (!name.trim()) {
                resultDiv.style.display = 'block';
                resultDiv.className = 'result error';
                resultDiv.textContent = '‚ùå –í–≤–µ–¥–∏—Ç–µ –∏–º—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è';
                return;
            }
            
            resultDiv.style.display = 'block';
            resultDiv.textContent = '‚è≥ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—É—é —Ñ–æ—Ä–º—É...';
            
            try {
                const response = await fetch(`${API_URL}/api/submit-form`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        name: name,
                        attendance: attendance,
                        wishes: '–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç —Å–∏—Å—Ç–µ–º—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏'
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `üéâ –§–û–†–ú–ê –û–¢–ü–†–ê–í–õ–ï–ù–ê –£–°–ü–ï–®–ù–û!\n\n–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:\n${JSON.stringify(data, null, 2)}\n\n‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ email: abdumalikabdumalikov72@gmail.com`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `‚ùå –§–û–†–ú–ê –ù–ï –û–¢–ü–†–ê–í–õ–ï–ù–ê:\n\n${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå –û–®–ò–ë–ö–ê –û–¢–ü–†–ê–í–ö–ò:\n\n${error.message}`;
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            console.log('üß™ –¢–µ—Å—Ç —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            console.log('üîó API URL:', API_URL);
            
            // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∞–≤—Ç–æ—Ç–µ—Å—Ç–∞
            setTimeout(() => {
                console.log('üöÄ –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ health check...');
                testHealthCheck();
            }, 1000);
        });
    </script>
</body>
</html>